---
title: TCP vs UDP：到底有什么区别？
date: 2026-02-22 11:06:00
tags: [计算机网络, TCP, UDP, 入门教程]
categories: 技术
---

# TCP vs UDP：到底有什么区别？

在上一篇文章中，我们了解了计算机网络的四层模型。

今天，我们来深入聊聊传输层的两大核心协议：**TCP** 和 **UDP**。

它们就像两个性格不同的快递员，一个稳重可靠，一个风风火火。

---

## 🌰 比喻理解 TCP 和 UDP

### UDP：急性子的快递员

**特点：** 收到货就送，送完就走，不确认、不等待、不保证送达。

```
UDP 快递员：
┌─────────────────────────────────────┐
│  "有个包裹要送到 Room 808"          │
│  "啪！丢下包裹就走"                  │
│  "送达没？关我屁事"                  │
│  "后面还有一堆件呢，拜拜~"           │
└─────────────────────────────────────┘
```

**优点：** 速度快，管它到不到，送了就算

**缺点：** 可能丢件、可能乱序、不可靠

---

### TCP：慢性子的靠谱哥

**特点：** 每一步都确认，务必保证送到本人手里。

```
TCP 快递员：
┌─────────────────────────────────────┐
│  "有个包裹要送到 Room 808"          │
│  "喂？Room 808 在吗？"              │
│  "在啊" "好，我准备送了"            │
│  "等等，我先确认下地址对不对"         │
│  "对的对的" "好，我数三声接住"       │
│  "1... 2... 3... 接着！"            │
│  "接到了！" "好，我走了"             │
│  "等等！你确认我接到了再走啊！"       │
│  "好好好，确认送达，886"             │
└─────────────────────────────────────┘
```

**优点：** 可靠、安全、有序

**缺点：** 慢、占用资源多

---

## 📊 TCP vs UDP 核心对比

| 特性 | TCP | UDP |
|------|-----|-----|
| **连接方式** | 面向连接（需握手） | 无连接（直接发） |
| **可靠性** | 可靠（保证送达） | 不可靠（可能丢包） |
| **顺序** | 有序（按发送顺序） | 无序（可能乱套） |
| **速度** | 慢 | 快 |
| **资源占用** | 多 | 少 |
| **数据包大小** | 无限制（可流式） | 有上限（64KB） |
| **头部大小** | 20-60 字节 | 8 字节 |

---

## 🔧 详细解析 TCP

### 什么是 TCP？

**TCP (Transmission Control Protocol)**：传输控制协议。

它是最常见的传输层协议，负责在两台计算机之间建立**可靠的连接**，并保证数据**完整、有序**地到达。

### TCP 的三次握手

在传输数据之前，TCP 需要先"认识"对方，建立连接：

```
客户端                                    服务器

    │  ────── SYN ──────────────────────→│ 我想连接你
    │                                    │
    │  ────── SYN+ACK ─────────────────→│ 好的，同意
    │←───────────────────────────────────│
    │                                    │
    │  ────── ACK ─────────────────────→│ 确认连接
    │←───────────────────────────────────│
    │                                    │
    │         ✓ 连接建立成功！            │
```

**为什么需要三次？**
1. 客户端说：我想连你（客户端发送能力 OK）
2. 服务器说：好的，我准备好了（服务器收发能力 OK）
3. 客户端说：好，我知道你准备好了（客户端接收能力 OK）

**三次握手就是确认：双方都能正常收发数据。**

---

### TCP 的四次挥手

数据传输完毕后，需要断开连接：

```
客户端                                    服务器

    │  ────── FIN ──────────────────────→│ 我数据发完了
    │←───────────────────────────────────│ 好的，我知道了
    │  ────── ACK ──────────────────────→│
    │                                    │
    │  （服务器可能还有数据要发）         │
    │                                    │
    │←───────────── FIN ────────────────│ 我也发完了
    │  ────── ACK ──────────────────────→│ 好的，拜拜
    │←───────────────────────────────────│
    │                                    │
    │         ✓ 连接断开成功！            │
```

**为什么是四次？**
- 因为 TCP 是**全双工**的（两边都能发数据）
- 关闭时需要**两边都确认**不再发送数据

---

### TCP 的特点

#### 1. 可靠传输

```
发送端：            接收端：
  [数据1] ──────→  ✓ 收到，回个 ACK
  [数据2] ──────→  ✓ 收到，回个 ACK
  [数据3] ──────→  ✗ 丢了
  [数据3] ──────→  ✓ 收到，回个 ACK
```

**如果没收到 ACK？** 重发！

---

#### 2. 流量控制

接收方会告诉发送方："我缓冲区满了，你慢点发"

```
接收端：            发送端：
  "我的窗口剩 1MB"  →  收到，减速
  "我的窗口剩 512KB"→  收到，再减速
  "我的窗口满了"    →  收到，暂停
  "我清空了，继续"  →  收到，恢复
```

---

#### 3. 拥塞控制

网络堵车时，TCP 会自动减速：

```
网络状态：          发送端行为：
  畅通            →  加速（指数增长）
  开始丢包        →  踩刹车
  堵车            →  慢慢试探
  恢复            →  逐渐加速
```

---

### TCP 适用场景

- **网页浏览** (HTTP/HTTPS)
- **文件传输** (FTP)
- **电子邮件** (SMTP, POP3)
- **远程登录** (SSH, Telnet)
- **数据库同步**

---

## 🔧 详细解析 UDP

### 什么是 UDP？

**UDP (User Datagram Protocol)**：用户数据报协议。

它是一种**无连接**的协议，不建立连接，不保证送达，不保证顺序。

**就是一个字：快！**

---

### UDP 的特点

#### 1. 无连接

```
UDP：
  不用握手，直接发！
  
  [数据] ──────────→  收到
  [数据] ──────────→  收到
  [数据] ──────────→  丢
  [数据] ──────────→  收到
  
  "关我屁事，继续下一个"
```

---

#### 2. 不保证可靠

- **可能丢包**：发出去就不管了
- **可能重复**：同一份数据可能收到多次
- **可能乱序**：后发的可能先到

---

#### 3. 头部简单

```
TCP 头部：20-60 字节
┌─────────────────────────────────────────┐
│ 源端口 │ 目的端口 │ 序列号 │ 确认号...   │
└─────────────────────────────────────────┘

UDP 头部：固定 8 字节
┌──────────────────────┐
│ 源端口 │  目的端口   │
│ 长度   │   校验和    │
└──────────────────────┘
```

**头部越小，传输效率越高！**

---

### UDP 适用场景

- **视频流**（在线视频、直播）
- **实时游戏**（王者荣耀、和平精英）
- **语音/视频通话**（微信、Zoom）
- **DNS 查询**（域名解析）
- **广播/多播**

---

## 🎯 什么时候用 TCP？什么时候用 UDP？

### 用 TCP 当：

- 数据**必须**完整到达
- 顺序**必须**正确
- 可靠性 > 速度

**例子：** 打开网页、下载文件、发微信消息

### 用 UDP 当：

- 速度**必须**快
- 偶尔丢几个包**可以接受**
- 实时性 > 可靠性

**例子：** 玩游戏（卡一下没关系，慢了可不行）、看直播（卡一帧无感）

---

## 💡 常见问题

### Q1：HTTP 用 TCP 还是 UDP？

HTTP (及 HTTPS) 默认使用 **TCP**。

因为网页内容必须完整到达，丢一个字符都不行。

---

### Q2：微信/QQ 用 TCP 还是 UDP？

**都可能用：**

- 文字消息：TCP（可靠）
- 语音/视频通话：UDP（实时）
- 文件传输：TCP（完整）

---

### Q3：TCP 比 UDP 慢多少？

**不一定！**

- 在良好网络下，差异很小
- UDP 虽然快，但丢包后重传代价高
- 实际体验取决于具体场景

---

### Q4：有没有混合方案？

有！比如 **QUIC** (HTTP/3)：

- 基于 UDP
- 但实现了可靠性保证
- 结合了两者优点

---

## 🎮 实战：用命令测试 TCP 和 UDP

### 测试 TCP 端口

```bash
# 查看端口是否开放（TCP）
nc -zv www.example.com 80

# 或者用 telnet
telnet www.example.com 80
```

### 测试 UDP 端口

```bash
# 查看端口是否开放（UDP）
nc -zuv www.example.com 53
```

### 用 wireshark 抓包看 TCP vs UDP

```bash
# 只抓 TCP 包
tcpdump -i any tcp

# 只抓 UDP 包
tcpdump -i any udp

# 抓特定端口
tcpdump -i any port 80
```

---

## 📊 总结

| 方面 | TCP | UDP |
|------|-----|-----|
| **性格** | 靠谱稳重 | 风风火火 |
| **连接** | 先握手 | 直接发 |
| **可靠** | ✓ 保证送达 | ✗ 爱答不理 |
| **有序** | ✓ 按顺序 | ✗ 可能乱 |
| **速度** | 慢 | 快 |
| **用途** | 网页、文件、邮件 | 视频、游戏、直播 |
| **比喻** | 挂号信 | 喇叭喊话 |

---

## 🚀 写在最后

记住这个比喻：

> **TCP 就像寄信** → 对方必须签收，没收到会补寄
> **UDP 就像村里的大喇叭** → 喊完就走，听没听到不保证

两种协议没有好坏之分，只有**适用场景不同**。

选择合适的协议，才能做出更好的系统！

---

**下期预告：** 域名和 DNS 解析原理

---

**相关文章：**
- [一文读懂计算机网络四层模型](/)
- [TCP 三次握手详解](/)
